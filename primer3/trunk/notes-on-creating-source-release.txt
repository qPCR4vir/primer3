# 0 UPDATE RELEASE NUMBER
# 0.1 change in libprimer3_release() (liprimer3.c)
# 0.2 change in create_tag_files_and_docs.pl (primer3/documentation/trunk/)

# 1 DO A CLEAN CHECKOUT AND TEST IT
svn co https://primer3.svn.sourceforge.net/svnroot/primer3/primer3/trunk

# go to primer3/primer3/trunk/src/ and do

make test

..OR...

sh paranoid_tests.sh

# also test on Windows: clean checkout + make test TESTOPTS=--windows

# 2 TAG THE RELEASE -- create the directory under primer3/primer3/tags/
cd primer3/primer3
svn cp trunk tags/release-<release number>
svn ci  -m 'tagged release-<release number>'

# 2.1 TAG THE *DOCUMENTATION* RELEASE AND TEST
cd primer3/documentation
svn cp trunk tags/release-<release number>
svn ci  -m 'tagged DOCUMENTATION release-<release number>'
cd tags/release-<release number>
perl create_tag_files_and_doc.pl
# make sure the file script_output/primer3_manual.htm is intact, e.g.
firefox script_output/primer3_manual.htm

# 3 TEST TAGGED RELEASE
svn co https://primer3.svn.sourceforge.net/svnroot/primer3/primer3/tags/release-<release number>
# OPTIONALLY, test it all again in this directory (May not be worth it
# since testing takes much longer than creating the files system copy
# plus the .tar.gz file, and then testing that.)
cd ...primer3/primer3/tags/release-<release number>/src # Where you did the check out.
make test
make clean

# 4 MAKE A FILE SYSTEM COPY OF THE RELEASE AND REMOVE SVN STUFF FROM IT

# cd to the *newly checked-out* .../primer3/tags/ directory and make a
# *file system* only copy

cp -rfp release-<release number> <SOMEWHERE>/primer3-<release number>

cd <SOMEWHERE>/primer3-<release number>

# Get rid of the svn stuff
rm -rf .svn
rm -rf */.svn
rm -rf */*/.svn
rm -rf */*/*/.svn
rm notes-on-creating-source-release.txt
rm p3_th_settings.txt

# look for other hidden L/Unix files
ls -ld .??*
ls -ld */.??*
ls -ld */*/.??*
ls -ld */*/*/.??*
ls -ld */*/*/*/.??*
# Delete any if necessary

# Copy the manual
cd <SOMEWHERE>/primer3-<release number>/
# copy primer3_manual.htm for SVN directory to the release directory
cp <SVN PRIMER3>/documentation/tags/release-<release number>/script_output/primer3_manual.htm .

# 5 TAR AND GZIP THE FILE SYSTEM COPY AND TEST IT

tar cvfz primer3-<release number>.tar.gz <SOMEWHERE>primer3-<release number>

# Test the tar'ed source release
# take primer3-<release number>.tar.gz to another location, unzip/untar it, and test it,
# either with
make test
# or
sh paranoid_tests.sh  >& test.out &

# 6 UPLOAD TO SOURCEFORGE AND MAKE THE primer3-<release number>.tar.gz visible to the world

# Use the Files tab on the web interface (at https://sourceforge.net/projects/primer3/develop) 
# *after logging in* to create the folder for the new release, then upload the new files
# either from the SourceForge web interface, or by the local command

scp primer3-<release number>.tar.gz <user-name>,primer3@frs.sourceforge.net:/home/frs/project/p/pr/primer3/primer3/<release_number>/
(same for latest release notes and primer3_manual.htm)

# check if the file is available for download (may need to wait several minutes until the site gets updated):
firefox https://sourceforge.net/projects/primer3/files/

# 7 DOWNLOAD THE NEWLY UPLOADED primer3-<release number>.tar.gz FROM SOURCEFORGE AND TEST IT

# 8 MAKE primer3-<release number>.tag.gz THE DEFAULT FOR ALL OSes.
# In browser go to https://sourceforge.net/projects/primer3/files/primer3/<release number>
# Click on the "Circle-I" button near the file primer-<release number>.tar.gz, and look on
# lower right of page for "Default Download For:", then find "Select all" and click on it.
# Then click on "Save" (lower left)

# 9 UPDATE THE SOURCEFORGE WEB PAGE

# get the files:
rsync -avz <username>,primer3@web.sourceforge.net:htdocs/ .
# You will need to supply your SourceForge user name

# edit & modify

# upload them back:
rsync -avz *.php <username>,primer3@web.sourceforge.net:htdocs/
